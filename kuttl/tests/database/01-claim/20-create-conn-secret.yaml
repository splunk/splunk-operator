apiVersion: kuttl.dev/v1beta1
kind: TestStep
commands:
- command: bash -ceu ' \
    U=$(kubectl -n splunk get secret shc-db-app -o jsonpath="{.data.username}" | base64 -d); \
    P=$(kubectl -n splunk get secret shc-db-app -o jsonpath="{.data.password}" | base64 -d); \
    D=$(kubectl -n splunk get secret shc-db-app -o jsonpath="{.data.dbname}" | base64 -d); \
    cat <<EOF | kubectl -n splunk apply -f - \
apiVersion: v1
kind: Secret
metadata:
  name: shc-db-conn
type: Opaque
stringData:
  host: shc-db-rw.splunk.svc
  port: "5432"
  dbname: "$D"
  username: "$U"
  password: "$P"
  sslmode: require
EOF
`
timeout: 120