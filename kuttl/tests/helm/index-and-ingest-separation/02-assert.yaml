---
# assert for ingestor cluster custom resource to be ready
apiVersion: enterprise.splunk.com/v4
kind: IngestorCluster
metadata:
  name: ingestor
spec:
  replicas: 4
  pipelineConfig:
    remoteQueueRuleset: false
    ruleSet: true
    remoteQueueTyping: false
    remoteQueueOutput: false
    typing: true
    indexerPipe: true
  pushBus:
    type: sqs_smartbus
    sqs:
      queueName: kkoziol-sqs-test
      authRegion: us-west-2
      endpoint: https://sqs.us-west-2.amazonaws.com
      largeMessageStoreEndpoint: https://s3.us-west-2.amazonaws.com
      largeMessageStorePath: s3://kkoziol-ingestion/smartbus-test-kkoziol
      deadLetterQueueName: kkoziol-sqs-dlq-test
      maxRetriesPerPart: 4
      retryPolicy: max_count
      sendInterval: 5s
      encodingFormat: s2s
status:
  phase: Ready
  pipelineConfig:
    remoteQueueRuleset: false
    ruleSet: true
    remoteQueueTyping: false
    remoteQueueOutput: false
    typing: true
    indexerPipe: true
  pushBus:
    type: sqs_smartbus
    sqs:
      queueName: kkoziol-sqs-test
      authRegion: us-west-2
      endpoint: https://sqs.us-west-2.amazonaws.com
      largeMessageStoreEndpoint: https://s3.us-west-2.amazonaws.com
      largeMessageStorePath: s3://kkoziol-ingestion/smartbus-test-kkoziol
      deadLetterQueueName: kkoziol-sqs-dlq-test
      maxRetriesPerPart: 4
      retryPolicy: max_count
      sendInterval: 5s
      encodingFormat: s2s

---
# check for stateful sets and replicas updated
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: splunk-ingestor-ingestor
status:
  replicas: 4
