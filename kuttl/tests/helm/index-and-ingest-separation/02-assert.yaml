---
# assert for queue custom resource to be ready
apiVersion: enterprise.splunk.com/v4
kind: Queue
metadata:
  name: queue
spec:
  provider: sqs
  sqs:
    name: index-ingest-separation-test-q
    authRegion: us-west-2
    endpoint: https://sqs.us-west-2.amazonaws.com
    dlq: index-ingest-separation-test-dlq

---
# assert for object storage custom resource to be ready
apiVersion: enterprise.splunk.com/v4
kind: ObjectStorage
metadata:
  name: os
spec:
  provider: s3
  s3:
    endpoint: https://s3.us-west-2.amazonaws.com
    path: s3://index-ingest-separation-test-bucket/smartbus-test

---
# assert for cluster manager custom resource to be ready
apiVersion: enterprise.splunk.com/v4
kind: ClusterManager
metadata:
  name: cm
status:
  phase: Ready

---
# check if stateful sets are created
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: splunk-cm-cluster-manager
status:
  replicas: 1

---
# check if secret object are created
apiVersion: v1
kind: Secret
metadata:
  name: splunk-cm-cluster-manager-secret-v1

---
# assert for indexer cluster custom resource to be ready
apiVersion: enterprise.splunk.com/v4
kind: IndexerCluster
metadata:
  name: indexer
spec:
  replicas: 3
  queueRef:
    name: queue
  objectStorageRef:
    name: os
status:
  phase: Ready
  
---
# check for stateful set and replicas as configured
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: splunk-indexer-indexer
status:
  replicas: 3

---
# check if secret object are created
apiVersion: v1
kind: Secret
metadata:
  name: splunk-indexer-indexer-secret-v1

---
# assert for indexer cluster custom resource to be ready
apiVersion: enterprise.splunk.com/v4
kind: IngestorCluster
metadata:
  name: ingestor
spec:
  replicas: 3
  queueRef:
    name: queue
  objectStorageRef:
    name: os
status:
  phase: Ready

---
# check for stateful set and replicas as configured
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: splunk-ingestor-ingestor
status:
  replicas: 3

---
# check if secret object are created
apiVersion: v1
kind: Secret
metadata:
  name: splunk-ingestor-ingestor-secret-v1